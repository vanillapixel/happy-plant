<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Happy plants — Quick Reference</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="./assets/img/happy-plants-logo.png" type="image/x-icon" />
    <meta name="description"
        content="Quick reference for ideal pH and moisture levels for common plants like basil, sage, cherry tomatoes, and cat grass. Includes moisture targets for daily checks." />
    <meta name="keywords"
        content="plant care, pH levels, moisture levels, basil, sage, cherry tomatoes, cat grass, gardening tips" />
    <meta name="author" content="Plant Enthusiast" />
    <meta name="robots" content="index, follow" />
    <meta property="og:title" content="Happy plants — Quick Reference" />
    <meta property="og:description"
        content="Quick reference for ideal pH and moisture levels for common plants like basil, sage, cherry tomatoes, and cat grass. Includes moisture targets for daily checks." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://example.com/plant-needs" />
    <meta property="og:image" content="./assets/img/happy-plants-logo.png" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Happy plants — Quick Reference" />
    <meta name="twitter:description"
        content="Quick reference for ideal pH and moisture levels for common plants like basil, sage, cherry tomatoes, and cat grass. Includes moisture targets for daily checks." />
    <meta name="twitter:image" content="./assets/img/happy-plants-logo.png" />
    <link rel="canonical" href="https://ithinkitsfun.it/happy-plants" />
    <!-- <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script> -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module" src="./src/vue-app.js"></script>
    <!-- style.css -->
    <link rel="stylesheet" href="./src/styles.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.2/sql-wasm.js"></script>
    <style>
        body.modal-open {
            overflow: hidden;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-800 dark:bg-slate-900 dark:text-slate-100">
    <div id="app" class="max-w-4xl mx-auto px-4 py-6">
        <!-- Header -->
        <header class="flex items-center gap-4 mb-6 relative">
            <div class="shrink-0 w-12 h-12">
                <img class="w-full h-full object-contain" src="./assets/img/happy-plants-logo.png"
                    alt="Happy plants logo" />
            </div>
            <div>
                <h1 class="text-2xl font-semibold" v-text="t('app_title')"></h1>
            </div>
            <div class="ml-auto flex items-center gap-2">
                <select aria-label="Language" v-model="locale"
                    class="rounded-md border-slate-300 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 text-xs px-2 py-1 focus:border-sky-500 focus:ring-sky-500">
                    <option value="en">EN</option>
                    <option value="it">IT</option>
                </select>
                <button class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700" :title="authTitle"
                    @click="onAuthClick">
                    <i :class="authed ? 'fas fa-sign-out-alt' : 'fas fa-user'"
                        class="text-slate-700 dark:text-slate-200"></i>
                </button>
            </div>
        </header>

        <!-- Weather section -->
        <section id="weather"
            class="bg-white dark:bg-slate-800 rounded-xl shadow-sm ring-1 ring-slate-200 dark:ring-slate-700 overflow-hidden mb-6 p-4">
            <div class="flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400">
                <span>Location:</span>
                <span class="font-medium" v-text="weather.location || weather.city"></span>
            </div>
            <div class="mt-2" v-if="weather.today">
                <div class="flex flex-col md:flex-row md:items-center gap-4">
                    <div class="flex items-center gap-3 min-w-[220px]">
                        <i :class="weather.today.icon" class="text-2xl"></i>
                        <div class="text-sm">
                            <div class="font-medium">Today</div>
                            <div class="text-slate-600 dark:text-slate-300">
                                <span v-if="weather.today.tempMax != null">{{ Math.round(weather.today.tempMax)
                                    }}°C</span>
                                <span v-if="weather.today.precipSum != null"> · {{
                                    Number(weather.today.precipSum).toFixed(1) }}mm</span>
                                <span v-if="weather.today.precipProb != null"> · {{ Math.round(weather.today.precipProb)
                                    }}%</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex flex-col items-start gap-1">
                        <div class="flex items-start gap-2">
                            <span aria-label="watering level" class="inline-flex items-center gap-1">
                                <i v-for="n in 3" :key="n" class="fas fa-tint"
                                    :class="n <= weather.today.level ? 'text-sky-600' : 'text-slate-300 dark:text-slate-600'"></i>
                            </span>
                            <span class="text-sm" :class="[
                                weather.today.level === 1 ? 'text-emerald-600' : '',
                                weather.today.level === 2 ? 'text-amber-600' : '',
                                weather.today.level === 3 ? 'text-orange-600' : ''
                            ]">
                                {{
                                weather.today.level === 1 ? 'Light watering' :
                                weather.today.level === 2 ? 'Moderate watering' :
                                weather.today.level === 3 ? 'Heavy watering' : 'Unknown' }}
                            </span>
                        </div>
                        <span class="text-xs text-slate-400 mt-1" v-if="weather.today.reason">{{ weather.today.reason
                            }}</span>
                    </div>
                </div>
            </div>
            <div class="mt-4" v-if="weather.next && weather.next.length">
                <p class="text-sm font-medium text-slate-500 dark:text-slate-400 mb-2">Forecast (next 2 days)</p>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <div v-for="(d,i) in weather.next" :key="d.date"
                        class="flex items-center gap-3 p-2 rounded-md bg-slate-50 dark:bg-slate-700/40">
                        <i :class="d.icon" class="text-xl"></i>
                        <div class="text-sm">
                            <div class="font-medium">{{ d.date }}</div>
                            <div class="text-slate-600 dark:text-slate-300">
                                <span v-if="d.tempMax != null">{{ Math.round(d.tempMax) }}°C</span>
                                <span v-if="d.precipSum != null"> · {{ Number(d.precipSum).toFixed(1) }}mm</span>
                                <span v-if="d.precipProb != null"> · {{ Math.round(d.precipProb) }}%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-2 text-xs text-slate-500 dark:text-slate-400" v-if="weather.error">{{ weather.error }}</div>
        </section>

        <!-- Quick add a new plant instance -->
        <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm ring-1 ring-slate-200 dark:ring-slate-700 p-4 mb-6">
            <div class="grid gap-4 md:grid-cols-3 relative">
                <div class="md:col-span-2">
                    <label for="species-name-input" class="block text-sm font-medium text-slate-400 mb-1"
                        v-text="t('species_label')"></label>
                    <div class="relative">
                        <input type="text" id="species-name-input" :placeholder="t('placeholder_species')"
                            v-model.trim="newPlantForm.species_name"
                            class="w-full rounded-md border-slate-300 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 focus:border-sky-500 focus:ring-sky-500 dark:focus:border-sky-400 dark:focus:ring-sky-400 px-3 py-2" />
                        <div class="absolute left-0 right-0 mt-1 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-md shadow z-10 max-h-56 overflow-auto"
                            v-if="newPlantForm.species_name && newPlantForm.species_name.length >= 2 && speciesSuggestions.length">
                            <div class="px-3 py-2 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/60"
                                v-for="s in speciesSuggestions" :key="s.id"
                                @click="newPlantForm.species_name = s.common_name; speciesSuggestions = []">
                                <div class="font-medium">{{ tSpecies(s.common_name) }}</div>
                                <div class="text-xs text-slate-500 dark:text-slate-400" v-if="s.scientific_name">{{
                                    s.scientific_name }}</div>
                            </div>
                        </div>
                    </div>
                    <p class="text-sm text-red-500 dark:text-red-400 mt-1" v-if="speciesError">{{ speciesError }}</p>
                </div>
                <div class="md:col-span-1">
                    <label for="new-plant-label-input" class="block text-sm font-medium text-slate-400 mb-1"
                        v-text="t('label_label')"></label>
                    <input id="new-plant-label-input" type="text" :placeholder="t('placeholder_label')"
                        v-model.trim="newPlantForm.label"
                        class="w-full rounded-md border-slate-300 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 focus:border-sky-500 focus:ring-sky-500 dark:focus:border-sky-400 dark:focus:ring-sky-400 px-3 py-2" />
                </div>
            </div>
            <div class="mt-4">
                <button @click="addUserPlant" v-text="t('add_plant_btn')"
                    class="inline-flex items-center gap-2 rounded-md bg-sky-600 text-white px-4 py-2 hover:bg-sky-700">
                    <i class="fas fa-plus mr-1"></i>
                </button>
            </div>
        </div>

        <section id="chart-section" class="mb-6">

            <!-- Select a user plant instance -->
            <div id="plant-selection" class="flex flex-col md:flex-row md:items-end gap-4 mb-4">
                <div class="w-full md:w-auto">
                    <label for="plantDropdown" class="block text-sm font-medium text-slate-400 mb-1"
                        v-text="t('select_plant_label')"></label>
                    <select id="plantDropdown" v-model="selectedUserPlantId" @change="onPlantChange"
                        class="w-full md:w-64 rounded-md border-slate-300 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 focus:border-sky-500 focus:ring-sky-500 dark:focus:border-sky-400 dark:focus:ring-sky-400 px-3 py-2">
                        <option value="">--Choose a Plant--</option>
                        <option v-for="p in userPlants" :key="p.id" :value="String(p.id)">{{ p.label }} ({{
                            tSpecies(p.species) }})</option>
                    </select>
                </div>
                <div>
                    <button id="addReadingBtn" :disabled="!authed" @click="openAddModal" v-text="t('add_reading_btn')"
                        class="inline-flex items-center gap-2 rounded-md bg-emerald-600 text-white px-4 py-2 hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-plus mr-1"></i>
                    </button>
                </div>
            </div>


            <div class="flex items-center gap-6 mb-4 text-sm text-slate-700 dark:text-slate-200">
                <label class="inline-flex items-center gap-2">
                    <input type="radio" name="dataType" class="text-sky-600 focus:ring-sky-600" value="ph"
                        v-model="dataType" @change="onTypeChange">
                    {{ t('dataType_ph') }}
                </label>
                <label class="inline-flex items-center gap-2">
                    <input type="radio" name="dataType" class="text-sky-600 focus:ring-sky-600" value="moisture"
                        v-model="dataType" @change="onTypeChange">
                    {{ t('dataType_moisture') }}
                </label>
                <label class="inline-flex items-center gap-2">
                    <input type="radio" name="dataType" class="text-sky-600 focus:ring-sky-600" value="fertility"
                        v-model="dataType" @change="onTypeChange">
                    {{ t('dataType_fertility') }}
                </label>
            </div>
            <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm ring-1 ring-slate-200 dark:ring-slate-700 p-4">
                <div v-if="!chartData.length" class="text-slate-500 dark:text-slate-400 text-center py-12">No data
                    available for the selected plant.</div>
                <canvas id="plants-chart" width="600" height="400" v-else class="w-full"></canvas>
            </div>
        </section>
        <!-- <section id="notes-section"
            class="bg-white dark:bg-slate-800 rounded-xl shadow-sm ring-1 ring-slate-200 dark:ring-slate-700 p-4">
            <p class="font-medium mb-2" v-text="t('notes_title')"></p>
            <ul class="space-y-2 mb-4">
                <li class="text-slate-700 dark:text-slate-200"><i class="fas fa-leaf text-emerald-600"></i> {{ t('notes_li_1') }}</li>
                <li class="text-slate-700 dark:text-slate-200"><i class="fas fa-seedling text-emerald-600"></i> {{ t('notes_li_2') }}</li>
                <li class="text-slate-700 dark:text-slate-200"><img class="inline w-4 h-4 align-text-bottom" src="./assets/img/icons/grass-icon.svg" alt=""> {{ t('notes_li_3') }}</li>
                <li class="text-slate-700 dark:text-slate-200"><img class="inline w-4 h-4 align-text-bottom" src="./assets/img/icons/tomato-icon.svg" alt=""> {{ t('notes_li_4') }}</li>
            </ul>
            <ul class="space-y-2 text-slate-700 dark:text-slate-200">
                <li>{{ t('notes_li_5') }}</li>
                <li><i class="fas fa-sun text-yellow-500"></i> {{ t('notes_li_6') }}</li>
                <li><i class="fas fa-moon"></i> {{ t('notes_li_7') }}</li>
            </ul>
    </section>
        <!-- Modals controlled by Vue -->
        <!-- Auth Modal -->
        <div class="fixed inset-0 z-50 bg-black/50 p-4 flex items-center justify-center" v-if="showAuthModal">
            <div class="relative bg-white dark:bg-slate-800 w-full max-w-md rounded-xl shadow-xl">
                <button
                    class=" z-10 absolute top-3 right-3 text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200"
                    @click="closeModals">
                    <i class="fas fa-times"></i>
                </button>
                <div class="p-6">
                    <div class="flex gap-2 mb-4">
                        <button class="px-3 py-2 rounded-md text-sm font-medium dark:bg-slate-700 dark:text-slate-200"
                            :class="authTab==='login' ? 'bg-slate-900 text-white' : 'bg-slate-100 text-slate-700'"
                            @click="authTab='login'">Login</button>
                        <button class="px-3 py-2 rounded-md text-sm font-medium dark:bg-slate-700 dark:text-slate-200"
                            :class="authTab==='register' ? 'bg-slate-900 text-white' : 'bg-slate-100 text-slate-700'"
                            @click="authTab='register'">Register</button>
                    </div>
                    <div v-show="authTab==='login'">
                        <form @submit.prevent="login" class="space-y-3">
                            <label class="block text-sm font-medium text-slate-400">Email or Username
                                <input type="text" v-model.trim="loginForm.identifier" required
                                    class="mt-1 w-full rounded-md border-slate-300 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 focus:border-sky-500 focus:ring-sky-500 dark:focus:border-sky-400 dark:focus:ring-sky-400 px-3 py-2" />
                            </label>
                            <label class="block text-sm font-medium text-slate-400">Password
                                <input type="password" v-model="loginForm.password" minlength="8" required
                                    class="mt-1 w-full rounded-md border-slate-300 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 focus:border-sky-500 focus:ring-sky-500 dark:focus:border-sky-400 dark:focus:ring-sky-400 px-3 py-2" />
                            </label>
                            <button type="submit"
                                class="w-full rounded-md bg-sky-600 text-white px-4 py-2 hover:bg-sky-700">Sign
                                in</button>
                        </form>
                    </div>
                    <div v-show="authTab==='register'">
                        <form @submit.prevent="register" class="space-y-3">
                            <label class="block text-sm font-medium text-slate-400">Email
                                <input type="email" v-model.trim="registerForm.email" required
                                    class="mt-1 w-full rounded-md border-slate-300 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 focus:border-sky-500 focus:ring-sky-500 dark:focus:border-sky-400 dark:focus:ring-sky-400 px-3 py-2" />
                            </label>
                            <label class="block text-sm font-medium text-slate-400">Username
                                <input type="text" v-model.trim="registerForm.username" required
                                    class="mt-1 w-full rounded-md border-slate-300 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 focus:border-sky-500 focus:ring-sky-500 dark:focus:border-sky-400 dark:focus:ring-sky-400 px-3 py-2" />
                            </label>
                            <label class="block text-sm font-medium text-slate-400">Password
                                <input type="password" v-model="registerForm.password" minlength="8" required
                                    class="mt-1 w-full rounded-md border-slate-300 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 focus:border-sky-500 focus:ring-sky-500 dark:focus:border-sky-400 dark:focus:ring-sky-400 px-3 py-2" />
                            </label>
                            <label class="block text-sm font-medium text-slate-400">City (for weather)
                                <input type="text" v-model.trim="registerForm.city" placeholder="e.g., Utrecht"
                                    class="mt-1 w-full rounded-md border-slate-300 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 focus:border-sky-500 focus:ring-sky-500 dark:focus:border-sky-400 dark:focus:ring-sky-400 px-3 py-2" />
                                <span class="text-xs text-slate-500">Defaults to Utrecht, Netherlands if empty.</span>
                            </label>
                            <button type="submit"
                                class="w-full rounded-md bg-sky-600 text-white px-4 py-2 hover:bg-sky-700">Create
                                account</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Reading Modal -->
        <div class="fixed inset-0 z-50 bg-black/50 p-4 flex items-center justify-center" v-if="showAddModal">
            <div class="relative bg-white dark:bg-slate-800 w-full max-w-xl rounded-xl shadow-xl">
                <button
                    class="z-10 absolute top-3 right-3 text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200"
                    @click="closeModals"><i class="fas fa-times"></i></button>
                <div class="p-6">
                    <form class="space-y-6" @submit.prevent="saveReading">
                        <div>
                            <p class="block text-sm font-medium text-slate-300 mb-2" v-text="t('modal_select_plant')">
                            </p>
                            <div class="flex items-center gap-2">
                                <button type="button" @click="goPrevPlant" :disabled="!userPlants.length"
                                    class="h-10 w-10 flex items-center justify-center rounded-md text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 disabled:opacity-40"><i
                                        class="text-sm fas fa-chevron-left"></i></button>
                                <select id="plant" v-model="addForm.user_plant_id" required
                                    class="flex-1 h-10 rounded-md border-slate-300 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 focus:border-sky-500 focus:ring-sky-500 dark:focus:border-sky-400 dark:focus:ring-sky-400 px-3">
                                    <option v-for="p in userPlants" :key="p.id" :value="String(p.id)">{{ p.label }} ({{
                                        tSpecies(p.species) }})</option>
                                </select>
                                <button type="button" @click="goNextPlant" :disabled="!userPlants.length"
                                    class="h-10 w-10 flex items-center justify-center rounded-md text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 disabled:opacity-40"><i
                                        class="text-sm fas fa-chevron-right"></i></button>
                            </div>
                            <ul v-if="currentPlantSuggestions.length"
                                class="mt-3 space-y-1 text-xs text-slate-600 dark:text-slate-300 list-disc pl-4">
                                <li v-for="(sug,i) in currentPlantSuggestions" :key="i">{{ sug }}</li>
                            </ul>
                        </div>
                        <div class="grid gap-6 md:grid-cols-3">
                            <div class="block text-sm font-medium text-slate-500">
                                <div class="flex justify-between items-center mb-1"><span>{{ t('ph_level')
                                        }}</span><span class="text-xs" v-if="addForm.ph != null">{{
                                        Number(addForm.ph).toFixed(1) }}</span></div>
                                <input type="range" min="3" max="10" step="0.1" v-model.number="addForm.ph"
                                    aria-label="pH level" class="w-full hp-slider" :style="phSliderStyle" />
                            </div>
                            <div class="block text-sm font-medium text-slate-500">
                                <div class="flex justify-between items-center mb-1"><span>{{ t('moisture_level')
                                        }}</span><span class="text-xs" v-if="addForm.moisture != null">{{
                                        addForm.moisture }}%</span></div>
                                <input type="range" min="0" max="100" step="1" v-model.number="addForm.moisture"
                                    aria-label="Moisture level" class="w-full hp-slider" :style="moistureSliderStyle" />
                            </div>
                            <div class="block text-sm font-medium text-slate-500">
                                {{ t('fertility_label') }}
                                <div class="mt-1 flex items-center gap-3">
                                    <button type="button" @click="addForm.fertility = 0"
                                        :class="addForm.fertility === 0 ? 'opacity-100 ring-2 ring-red-500' : 'opacity-60'"
                                        class="h-10 w-10 rounded-full border border-red-500 text-red-500 flex items-center justify-center transition-opacity bg-transparent"><i
                                            class="fas fa-signal"></i></button>
                                    <button type="button" @click="addForm.fertility = 1"
                                        :class="addForm.fertility === 1 ? 'opacity-100 ring-2 ring-yellow-400' : 'opacity-60'"
                                        class="h-10 w-10 rounded-full border border-yellow-400 text-yellow-400 flex items-center justify-center transition-opacity bg-transparent"><i
                                            class="fas fa-signal"></i></button>
                                    <button type="button" @click="addForm.fertility = 2"
                                        :class="addForm.fertility === 2 ? 'opacity-100 ring-2 ring-green-500' : 'opacity-60'"
                                        class="h-10 w-10 rounded-full border border-green-500 text-green-500 flex items-center justify-center transition-opacity bg-transparent"><i
                                            class="fas fa-signal"></i></button>
                                </div>
                            </div>
                        </div>
                        <button type="submit"
                            class="w-full rounded-md bg-emerald-600 text-white px-4 py-2 hover:bg-emerald-700"
                            v-text="t('save_reading_continue')"></button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>

</html>